<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ… - Ø¨Ø§Ø²ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            z-index: -1;
        }
        
        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .war-btn {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .war-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .war-btn:hover::before {
            left: 100%;
        }
        
        .war-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }
        
        .peace-btn {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }
        
        .peace-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
        }
        
        .neutral-btn {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .neutral-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        .admin-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .war-input {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(148, 163, 184, 0.3);
            border-radius: 12px;
            padding: 16px;
            color: white;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .war-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1);
        }
        
        .war-input::placeholder {
            color: rgba(148, 163, 184, 0.6);
        }
        
        .sidebar {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.3);
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            color: rgba(148, 163, 184, 0.8);
            margin: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .sidebar-item:hover {
            background: rgba(220, 38, 38, 0.1);
            color: #fca5a5;
            transform: translateX(-4px);
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .sidebar-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(100, 116, 139, 0.3);
            color: rgba(148, 163, 184, 0.5);
        }
        
        .sidebar-item.disabled:hover {
            background: rgba(100, 116, 139, 0.3);
            color: rgba(148, 163, 184, 0.5);
            transform: none;
        }
        
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #dc2626, #f59e0b, #059669, #3b82f6);
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .weapon-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 20px;
            padding: 28px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .weapon-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.05) 0%, rgba(245, 158, 11, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .weapon-card:hover::before {
            opacity: 1;
        }
        
        .weapon-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border-color: rgba(220, 38, 38, 0.4);
        }
        
        .news-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            border-right: 4px solid #dc2626;
            transition: all 0.3s ease;
        }
        
        .news-card:hover {
            transform: translateX(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(220, 38, 38, 0.3);
            border-top: 4px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .war-title {
            background: linear-gradient(135deg, #dc2626 0%, #f59e0b 50%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 10px rgba(220, 38, 38, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.8)); }
        }
        
        .mobile-menu {
            position: fixed;
            top: 80px;
            right: -100%;
            width: 280px;
            height: calc(100vh - 80px);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            z-index: 50;
            transition: right 0.4s ease;
            border-left: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .mobile-menu.open {
            right: 0;
        }
        
        .hamburger {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .hamburger:hover {
            background: rgba(220, 38, 38, 0.1);
        }
        
        .hamburger span {
            width: 28px;
            height: 3px;
            background: white;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-right: 0 !important;
            }
        }
        
        .trade-card {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            border: 1px solid rgba(5, 150, 105, 0.3);
            border-radius: 16px;
            padding: 24px;
        }
        
        .attack-card {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(153, 27, 27, 0.1) 100%);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 16px;
            padding: 24px;
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ -->
    <div id="loadingPage" class="min-h-screen flex items-center justify-center p-6">
        <div class="glass-card p-10 w-full max-w-md text-white text-center">
            <div class="text-8xl mb-6">âš”ï¸</div>
            <h1 class="text-4xl font-bold mb-6 war-title">Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ…</h1>
            <div class="loading-spinner mx-auto mb-6"></div>
            <p class="text-slate-300 text-lg mb-4" id="loadingText">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±...</p>
            <p class="text-sm text-yellow-400 mb-6">Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„ØªØ± Ø´Ú©Ù† Ø±Ø§ Ø±ÙˆØ´Ù† Ú©Ù†ÛŒØ¯</p>
            <button id="retryBtn" onclick="initializeFirebase()" class="war-btn hidden">
                ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
            </button>
        </div>
    </div>

    <!-- ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-6 hidden">
        <div class="glass-card p-10 w-full max-w-md text-white">
            <div class="text-center mb-10">
                <div class="text-8xl mb-6">âš”ï¸</div>
                <h1 class="text-4xl font-bold mb-4 war-title">Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ…</h1>
                <p class="text-slate-300 text-lg">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…ÛŒØ¯Ø§Ù† Ù†Ø¨Ø±Ø¯</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                    <input type="text" id="username" class="war-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                    <input type="password" id="password" class="war-input" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                </div>
                <button type="submit" class="war-btn w-full py-4 text-lg">
                    ğŸš€ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ù†Ú¯
                </button>
            </form>
            
            <div class="mt-8 text-center">
                <p class="text-xs text-slate-400">ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Ø§Ù†Ø¯Ù‡Ø§Ù† Ù…Ø¬Ø§Ø²</p>
            </div>
        </div>
    </div>

    <!-- Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† -->
    <div id="adminPanel" class="hidden">
        <nav class="navbar p-4">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-white flex items-center gap-4">
                    <span class="text-4xl">ğŸ‘‘</span>
                    ÙØ±Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ú©Ù„
                </h1>
                <div class="flex items-center gap-4">
                    <button class="md:hidden hamburger" onclick="toggleMobileMenu()" id="adminMenuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <button onclick="logout()" class="war-btn">
                        ğŸšª Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </nav>
        
        <div class="flex">
            <div class="sidebar w-72 hidden md:block" id="adminSidebar">
                <div class="p-6">
                    <div class="space-y-3">
                        <div onclick="showAdminSection('countries')" class="sidebar-item active" data-section="countries">
                            <span class="text-3xl">ğŸŒ</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø´ÙˆØ±Ù‡Ø§</span>
                        </div>
                        <div onclick="showAdminSection('economy')" class="sidebar-item" data-section="economy">
                            <span class="text-3xl">ğŸ’°</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚ØªØµØ§Ø¯</span>
                        </div>
                        <div onclick="showAdminSection('news')" class="sidebar-item" data-section="news">
                            <span class="text-3xl">ğŸ“°</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø®Ø¨Ø§Ø±</span>
                        </div>
                        <div onclick="showAdminSection('addCountry')" class="sidebar-item" data-section="addCountry">
                            <span class="text-3xl">â•</span>
                            <span>Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø´ÙˆØ±</span>
                        </div>
                        <div onclick="showAdminSection('statistics')" class="sidebar-item" data-section="statistics">
                            <span class="text-3xl">ğŸ“Š</span>
                            <span>Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</span>
                        </div>
                        <div onclick="showAdminSection('gameControl')" class="sidebar-item" data-section="gameControl">
                            <span class="text-3xl">ğŸ®</span>
                            <span>Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ø¯Ù…ÛŒÙ† -->
            <div class="mobile-menu" id="adminMobileMenu">
                <div class="p-6">
                    <div class="space-y-3">
                        <div onclick="showAdminSection('countries'); closeMobileMenu()" class="sidebar-item active" data-section="countries">
                            <span class="text-3xl">ğŸŒ</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø´ÙˆØ±Ù‡Ø§</span>
                        </div>
                        <div onclick="showAdminSection('economy'); closeMobileMenu()" class="sidebar-item" data-section="economy">
                            <span class="text-3xl">ğŸ’°</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚ØªØµØ§Ø¯</span>
                        </div>
                        <div onclick="showAdminSection('news'); closeMobileMenu()" class="sidebar-item" data-section="news">
                            <span class="text-3xl">ğŸ“°</span>
                            <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø®Ø¨Ø§Ø±</span>
                        </div>
                        <div onclick="showAdminSection('addCountry'); closeMobileMenu()" class="sidebar-item" data-section="addCountry">
                            <span class="text-3xl">â•</span>
                            <span>Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø´ÙˆØ±</span>
                        </div>
                        <div onclick="showAdminSection('statistics'); closeMobileMenu()" class="sidebar-item" data-section="statistics">
                            <span class="text-3xl">ğŸ“Š</span>
                            <span>Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</span>
                        </div>
                        <div onclick="showAdminSection('gameControl'); closeMobileMenu()" class="sidebar-item" data-section="gameControl">
                            <span class="text-3xl">ğŸ®</span>
                            <span>Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 p-6 main-content" style="margin-right: 288px;">
                <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø´ÙˆØ±Ù‡Ø§ -->
                <div id="adminCountries" class="admin-section">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸŒ</span>
                        Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø´ÙˆØ±Ù‡Ø§
                    </h2>
                    <div id="countriesList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
                </div>

                <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚ØªØµØ§Ø¯ -->
                <div id="adminEconomy" class="admin-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ’°</span>
                        Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚ØªØµØ§Ø¯
                    </h2>
                    <div class="glass-card p-8 max-w-4xl text-white">
                        <h3 class="text-xl font-bold mb-6">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø´ÙˆØ±</h3>
                        <select id="countrySelect" class="war-input mb-8">
                            <option value="">Ú©Ø´ÙˆØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                        </select>
                        <div id="countryEconomyForm" class="hidden space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù¾ÙˆÙ„ (Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±)</label>
                                    <input type="number" id="adminMoney" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">ÙÙ†Ø§ÙˆØ±ÛŒ (%)</label>
                                    <input type="number" id="adminTech" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø¯ÙØ§Ø¹ (%)</label>
                                    <input type="number" id="adminDefense" class="war-input">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú©</label>
                                    <input type="number" id="adminMissiles" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø³Ø±Ø¨Ø§Ø²</label>
                                    <input type="number" id="adminSoldiers" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†</label>
                                    <input type="number" id="adminBombers" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡</label>
                                    <input type="number" id="adminFighters" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">ØªØ§Ù†Ú©</label>
                                    <input type="number" id="adminTanks" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ</label>
                                    <input type="number" id="adminWarships" class="war-input">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù‡ÙˆØ§ÛŒÛŒ</label>
                                    <input type="number" id="adminAirDefense" class="war-input">
                                </div>
                            </div>
                            <button onclick="updateCountryEconomy()" class="admin-btn">
                                âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø®Ø¨Ø§Ø± -->
                <div id="adminNews" class="admin-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ“°</span>
                        Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø®Ø¨Ø§Ø±
                    </h2>
                    <div id="adminNewsList" class="space-y-6"></div>
                </div>

                <!-- Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø´ÙˆØ± -->
                <div id="adminAddCountry" class="admin-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">â•</span>
                        Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø´ÙˆØ± Ø¬Ø¯ÛŒØ¯
                    </h2>
                    <div class="glass-card p-8 max-w-3xl text-white">
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ù… Ú©Ø´ÙˆØ±</label>
                                    <input type="text" id="newCountryName" class="war-input" placeholder="Ù†Ø§Ù… Ú©Ø´ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                                    <input type="text" id="newCountryUsername" class="war-input" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-3">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                                    <input type="password" id="newCountryPassword" class="war-input" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                                </div>
                            </div>
                            <button onclick="addNewCountry()" class="admin-btn w-full py-4">
                                â• Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø´ÙˆØ± Ø¬Ø¯ÛŒØ¯
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
                <div id="adminStatistics" class="admin-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ“Š</span>
                        Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ø¨Ø§Ø²ÛŒ
                    </h2>
                    <div id="globalStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                </div>

                <!-- Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ -->
                <div id="adminGameControl" class="admin-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ®</span>
                        Ú©Ù†ØªØ±Ù„ Ú©Ù„ÛŒ Ø¨Ø§Ø²ÛŒ
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="glass-card p-8 text-white">
                            <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
                                <span class="text-3xl">ğŸ”´</span>
                                Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒ
                            </h3>
                            <p class="text-slate-300 mb-6">Ø¨Ø§ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒØŒ ØªÙ…Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¢Ù…Ø§Ø± Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†Ù†Ø¯ Ùˆ Ø§Ù…Ú©Ø§Ù† Ø­Ù…Ù„Ù‡ØŒ ØªØ¬Ø§Ø±Øª Ùˆ ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø±Ø§ Ù†Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø¯Ø§Ø´Øª.</p>
                            <button onclick="toggleGameStatus(false)" class="war-btn w-full py-4">
                                ğŸ”´ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒ
                            </button>
                        </div>
                        <div class="glass-card p-8 text-white">
                            <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
                                <span class="text-3xl">ğŸŸ¢</span>
                                Ø±ÙˆØ´Ù† Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒ
                            </h3>
                            <p class="text-slate-300 mb-6">Ø¨Ø§ Ø±ÙˆØ´Ù† Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒØŒ ØªÙ…Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø¯Ø§Ø´Øª Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø­Ù…Ù„Ù‡ØŒ ØªØ¬Ø§Ø±Øª Ùˆ ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù†Ø¯.</p>
                            <button onclick="toggleGameStatus(true)" class="peace-btn w-full py-4">
                                ğŸŸ¢ Ø±ÙˆØ´Ù† Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒ
                            </button>
                        </div>
                    </div>
                    <div class="glass-card p-8 mt-8 text-white">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3">
                            <span class="text-3xl">ğŸ“Š</span>
                            ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø¨Ø§Ø²ÛŒ
                        </h3>
                        <div id="gameStatusDisplay" class="text-center">
                            <div class="text-6xl mb-4" id="gameStatusIcon">ğŸŸ¢</div>
                            <p class="text-2xl font-bold" id="gameStatusText">Ø¨Ø§Ø²ÛŒ Ø±ÙˆØ´Ù† Ø§Ø³Øª</p>
                            <p class="text-slate-300 mt-2" id="gameStatusDesc">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¯Ø§Ø±Ù†Ø¯</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù¾Ù†Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù† -->
    <div id="playerPanel" class="hidden">
        <nav class="navbar p-4">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-white flex items-center gap-4" id="countryTitle">
                    <span class="text-4xl">ğŸ´</span>
                    ÙØ±Ù…Ø§Ù†Ø¯Ù‡ÛŒ Ú©Ø´ÙˆØ±
                </h1>
                <div class="flex items-center gap-4">
                    <button class="md:hidden hamburger" onclick="toggleMobileMenu()" id="playerMenuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <button onclick="logout()" class="war-btn">
                        ğŸšª Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </nav>
        
        <div class="flex">
            <div class="sidebar w-72 hidden md:block" id="playerSidebar">
                <div class="p-6">
                    <div class="space-y-3">
                        <div onclick="showPlayerSection('dashboard')" class="sidebar-item active" data-section="dashboard">
                            <span class="text-3xl">ğŸ“Š</span>
                            <span>ÙˆØ¶Ø¹ÛŒØª Ú©Ø´ÙˆØ±</span>
                        </div>
                        <div onclick="showPlayerSection('blackmarket')" class="sidebar-item" data-section="blackmarket">
                            <span class="text-3xl">ğŸ›’</span>
                            <span>Ø¨Ø§Ø²Ø§Ø± Ø³ÛŒØ§Ù‡</span>
                        </div>
                        <div onclick="showPlayerSection('statement')" class="sidebar-item" data-section="statement">
                            <span class="text-3xl">ğŸ“¢</span>
                            <span>ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡</span>
                        </div>
                        <div onclick="showPlayerSection('trade')" class="sidebar-item" data-section="trade">
                            <span class="text-3xl">ğŸ¤</span>
                            <span>ØªØ¬Ø§Ø±Øª</span>
                        </div>
                        <div onclick="showPlayerSection('attack')" class="sidebar-item" data-section="attack">
                            <span class="text-3xl">âš”ï¸</span>
                            <span>Ø­Ù…Ù„Ù‡ Ù†Ø¸Ø§Ù…ÛŒ</span>
                        </div>
                        <div onclick="showPlayerSection('news')" class="sidebar-item" data-section="news">
                            <span class="text-3xl">ğŸ“°</span>
                            <span>Ø§Ø®Ø¨Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§Ø²ÛŒÚ©Ù† -->
            <div class="mobile-menu" id="playerMobileMenu">
                <div class="p-6">
                    <div class="space-y-3">
                        <div onclick="showPlayerSection('dashboard'); closeMobileMenu()" class="sidebar-item active" data-section="dashboard">
                            <span class="text-3xl">ğŸ“Š</span>
                            <span>ÙˆØ¶Ø¹ÛŒØª Ú©Ø´ÙˆØ±</span>
                        </div>
                        <div onclick="showPlayerSection('blackmarket'); closeMobileMenu()" class="sidebar-item" data-section="blackmarket">
                            <span class="text-3xl">ğŸ›’</span>
                            <span>Ø¨Ø§Ø²Ø§Ø± Ø³ÛŒØ§Ù‡</span>
                        </div>
                        <div onclick="showPlayerSection('statement'); closeMobileMenu()" class="sidebar-item" data-section="statement">
                            <span class="text-3xl">ğŸ“¢</span>
                            <span>ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡</span>
                        </div>
                        <div onclick="showPlayerSection('trade'); closeMobileMenu()" class="sidebar-item" data-section="trade">
                            <span class="text-3xl">ğŸ¤</span>
                            <span>ØªØ¬Ø§Ø±Øª</span>
                        </div>
                        <div onclick="showPlayerSection('attack'); closeMobileMenu()" class="sidebar-item" data-section="attack">
                            <span class="text-3xl">âš”ï¸</span>
                            <span>Ø­Ù…Ù„Ù‡ Ù†Ø¸Ø§Ù…ÛŒ</span>
                        </div>
                        <div onclick="showPlayerSection('news'); closeMobileMenu()" class="sidebar-item" data-section="news">
                            <span class="text-3xl">ğŸ“°</span>
                            <span>Ø§Ø®Ø¨Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex-1 p-6 main-content" style="margin-right: 288px;">
                <!-- ÙˆØ¶Ø¹ÛŒØª Ú©Ø´ÙˆØ± -->
                <div id="playerDashboard" class="player-section">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ“Š</span>
                        ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ú©Ø´ÙˆØ±
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6" id="statsGrid"></div>
                </div>

                <!-- Ø¨Ø§Ø²Ø§Ø± Ø³ÛŒØ§Ù‡ -->
                <div id="playerBlackmarket" class="player-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ›’</span>
                        Ø¨Ø§Ø²Ø§Ø± Ø³ÛŒØ§Ù‡ ØªØ³Ù„ÛŒØ­Ø§Øª
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸš€</div>
                                <h3 class="text-xl font-bold mb-3">Ù…ÙˆØ´Ú© Ø¨Ø§Ù„Ø³ØªÛŒÚ©</h3>
                                <p class="text-red-400 font-bold text-lg">Û±Û°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="missileQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('missiles', 100)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸ‘¥</div>
                                <h3 class="text-xl font-bold mb-3">Ø³Ø±Ø¨Ø§Ø² Ù†Ø®Ø¨Ù‡</h3>
                                <p class="text-red-400 font-bold text-lg">Û² Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="soldierQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('soldiers', 2)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">âœˆï¸</div>
                                <h3 class="text-xl font-bold mb-3">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©</h3>
                                <p class="text-red-400 font-bold text-lg">ÛµÛ°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="bomberQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('bombers', 500)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸ›©ï¸</div>
                                <h3 class="text-xl font-bold mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡ Ù†Ø³Ù„ Ù¾Ù†Ø¬</h3>
                                <p class="text-red-400 font-bold text-lg">Û³Û°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="fighterQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('fighters', 300)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸš—</div>
                                <h3 class="text-xl font-bold mb-3">ØªØ§Ù†Ú© Ù¾ÛŒØ´Ø±ÙØªÙ‡</h3>
                                <p class="text-red-400 font-bold text-lg">Û¸Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="tankQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('tanks', 80)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸš¢</div>
                                <h3 class="text-xl font-bold mb-3">Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ</h3>
                                <p class="text-red-400 font-bold text-lg">Û±Û²Û°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="warshipQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('warships', 1200)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                        <div class="weapon-card text-white">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">ğŸ›¡ï¸</div>
                                <h3 class="text-xl font-bold mb-3">Ø³Ø§Ù…Ø§Ù†Ù‡ Ù¾Ø¯Ø§ÙÙ†Ø¯</h3>
                                <p class="text-red-400 font-bold text-lg">Û²Û°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±</p>
                            </div>
                            <input type="number" id="defenseQty" placeholder="ØªØ¹Ø¯Ø§Ø¯" class="war-input mb-6">
                            <button onclick="buyWeapon('airDefense', 200)" class="war-btn w-full">
                                ğŸ’° Ø®Ø±ÛŒØ¯
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡ -->
                <div id="playerStatement" class="player-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ“¢</span>
                        ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø±Ø³Ù…ÛŒ
                    </h2>
                    <div class="glass-card p-8 max-w-4xl text-white">
                        <textarea id="statementText" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø¬Ù‡Ø§Ù† Ø§Ø¹Ù„Ø§Ù… Ú©Ù†ÛŒØ¯..." class="war-input h-40 mb-6 resize-none"></textarea>
                        <button onclick="publishStatement()" class="peace-btn">
                            ğŸ“¢ Ø§Ù†ØªØ´Ø§Ø± Ø¨ÛŒØ§Ù†ÛŒÙ‡
                        </button>
                    </div>
                </div>

                <!-- ØªØ¬Ø§Ø±Øª -->
                <div id="playerTrade" class="player-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ¤</span>
                        Ø³ÛŒØ³ØªÙ… ØªØ¬Ø§Ø±Øª Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ
                    </h2>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="trade-card p-8 text-white">
                            <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
                                <span class="text-3xl">ğŸ“¤</span>
                                Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯
                            </h3>
                            <div class="space-y-6">
                                <select id="tradeCountry" class="war-input">
                                    <option value="">Ú©Ø´ÙˆØ± Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                </select>
                                <div class="grid grid-cols-1 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ù…Ø§</label>
                                        <input type="text" id="tradeGive" placeholder="Ù…Ø«Ø§Ù„: ÛµÛ°Û° Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø±" class="war-input">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§</label>
                                        <input type="text" id="tradeReceive" placeholder="Ù…Ø«Ø§Ù„: Û±Û°Û° Ù…ÙˆØ´Ú© Ø¨Ø§Ù„Ø³ØªÛŒÚ©" class="war-input">
                                    </div>
                                </div>
                                <button onclick="sendTradeRequest()" class="peace-btn w-full">
                                    ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                                </button>
                            </div>
                        </div>
                        <div class="trade-card p-8 text-white">
                            <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
                                <span class="text-3xl">ğŸ“¥</span>
                                Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
                            </h3>
                            <div id="tradeRequests" class="space-y-6"></div>
                        </div>
                    </div>
                </div>

                <!-- Ø­Ù…Ù„Ù‡ Ù†Ø¸Ø§Ù…ÛŒ -->
                <div id="playerAttack" class="player-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">âš”ï¸</span>
                        Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø¸Ø§Ù…ÛŒ
                    </h2>
                    <div class="attack-card p-8 max-w-4xl text-white">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ú©Ø´ÙˆØ± Ù‡Ø¯Ù</label>
                                <select id="attackTarget" class="war-input">
                                    <option value="">Ù‡Ø¯Ù Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ù†ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª</label>
                                <select id="attackType" class="war-input" onchange="updateAttackForm()">
                                    <option value="">Ù†ÙˆØ¹ Ø­Ù…Ù„Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>
                                    <option value="air">Ø­Ù…Ù„Ù‡ Ù‡ÙˆØ§ÛŒÛŒ âœˆï¸</option>
                                    <option value="land">Ø­Ù…Ù„Ù‡ Ø²Ù…ÛŒÙ†ÛŒ ğŸš—</option>
                                    <option value="sea">Ø­Ù…Ù„Ù‡ Ø¯Ø±ÛŒØ§ÛŒÛŒ ğŸš¢</option>
                                </select>
                            </div>
                            
                            <!-- ÙØ±Ù… Ø­Ù…Ù„Ù‡ Ù‡ÙˆØ§ÛŒÛŒ -->
                            <div id="airAttackForm" class="hidden">
                                <h3 class="text-xl font-bold mb-4 text-red-400">ğŸ›©ï¸ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ù‡ÙˆØ§ÛŒÛŒ</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.fighters || 0})</label>
                                        <input type="number" id="airFighters" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù†Ú¯Ù†Ø¯Ù‡" min="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.bombers || 0})</label>
                                        <input type="number" id="airBombers" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†" min="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.missiles || 0})</label>
                                        <input type="number" id="airMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="1">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÙØ±Ù… Ø­Ù…Ù„Ù‡ Ø²Ù…ÛŒÙ†ÛŒ -->
                            <div id="landAttackForm" class="hidden">
                                <h3 class="text-xl font-bold mb-4 text-red-400">ğŸš— ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ø²Ù…ÛŒÙ†ÛŒ</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">ØªØ§Ù†Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.tanks || 0})</label>
                                        <input type="number" id="landTanks" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ ØªØ§Ù†Ú©" min="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ø³Ø±Ø¨Ø§Ø² (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.soldiers || 0})</label>
                                        <input type="number" id="landSoldiers" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±Ø¨Ø§Ø²" min="1000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.missiles || 0})</label>
                                        <input type="number" id="landMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="1">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÙØ±Ù… Ø­Ù…Ù„Ù‡ Ø¯Ø±ÛŒØ§ÛŒÛŒ -->
                            <div id="seaAttackForm" class="hidden">
                                <h3 class="text-xl font-bold mb-4 text-red-400">ğŸš¢ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ø¯Ø±ÛŒØ§ÛŒÛŒ</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.warships || 0})</label>
                                        <input type="number" id="seaWarships" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ" min="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.missiles || 0})</label>
                                        <input type="number" id="seaMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry?.fighters || 0})</label>
                                        <input type="number" id="seaFighters" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù†Ú¯Ù†Ø¯Ù‡" min="1">
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="launchAttack()" class="war-btn w-full py-4 text-lg">
                                ğŸš€ Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ø®Ø¨Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ -->
                <div id="playerNews" class="player-section hidden">
                    <h2 class="text-3xl font-bold text-white mb-8 flex items-center gap-4">
                        <span class="text-4xl">ğŸ“°</span>
                        Ø§Ø®Ø¨Ø§Ø± Ø¬Ù‡Ø§Ù†ÛŒ
                    </h2>
                    <div id="newsList" class="space-y-6"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB3-grIuRV6LuJffSAhPfkkHPh6LkG9ft0",
            authDomain: "ww3-game-723e0.firebaseapp.com",
            projectId: "ww3-game-723e0",
            storageBucket: "ww3-game-723e0.firebasestorage.app",
            messagingSenderId: "296416147743",
            appId: "1:296416147743:web:eb9badd47253aec554582a",
            measurementId: "G-PPEN4R8HM0"
        };

        let db = null;
        let currentUser = null;
        let currentCountry = null;
        let gameEnabled = true;

        // Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú©Ø´ÙˆØ±Ù‡Ø§
        const countryDefaults = {
            'Ø¢Ù…Ø±ÛŒÚ©Ø§': { money: 5000, technology: 95, defense: 90, missiles: 1200, soldiers: 1500000, bombers: 500, fighters: 2000, tanks: 8000, warships: 300, airDefense: 600 },
            'Ø±ÙˆØ³ÛŒÙ‡': { money: 3000, technology: 88, defense: 85, missiles: 1000, soldiers: 1200000, bombers: 400, fighters: 1200, tanks: 6000, warships: 200, airDefense: 500 },
            'Ú†ÛŒÙ†': { money: 4000, technology: 85, defense: 80, missiles: 800, soldiers: 2500000, bombers: 300, fighters: 1500, tanks: 7000, warships: 250, airDefense: 450 },
            'Ø§ÛŒØ±Ø§Ù†': { money: 800, technology: 70, defense: 75, missiles: 400, soldiers: 600000, bombers: 80, fighters: 300, tanks: 1500, warships: 50, airDefense: 300 },
            'Ø§Ù†Ú¯Ù„ÛŒØ³': { money: 1500, technology: 90, defense: 85, missiles: 500, soldiers: 300000, bombers: 150, fighters: 600, tanks: 2000, warships: 120, airDefense: 350 },
            'ÙØ±Ø§Ù†Ø³Ù‡': { money: 1400, technology: 88, defense: 82, missiles: 450, soldiers: 280000, bombers: 140, fighters: 550, tanks: 1800, warships: 100, airDefense: 320 },
            'Ø¢Ù„Ù…Ø§Ù†': { money: 1800, technology: 92, defense: 80, missiles: 300, soldiers: 250000, bombers: 100, fighters: 500, tanks: 1600, warships: 80, airDefense: 300 },
            'Ú˜Ø§Ù¾Ù†': { money: 2200, technology: 93, defense: 78, missiles: 200, soldiers: 350000, bombers: 90, fighters: 700, tanks: 1000, warships: 150, airDefense: 280 },
            'Ú©Ø±Ù‡ Ø¬Ù†ÙˆØ¨ÛŒ': { money: 1200, technology: 85, defense: 75, missiles: 250, soldiers: 700000, bombers: 70, fighters: 400, tanks: 2000, warships: 60, airDefense: 250 },
            'Ø§Ø³Ø±Ø§Ø¦ÛŒÙ„': { money: 600, technology: 90, defense: 95, missiles: 600, soldiers: 200000, bombers: 80, fighters: 350, tanks: 800, warships: 30, airDefense: 400 },
            'ØªØ±Ú©ÛŒÙ‡': { money: 700, technology: 75, defense: 70, missiles: 300, soldiers: 500000, bombers: 60, fighters: 250, tanks: 1200, warships: 40, airDefense: 200 },
            'Ø¹Ø±Ø¨Ø³ØªØ§Ù†': { money: 1000, technology: 65, defense: 65, missiles: 200, soldiers: 400000, bombers: 50, fighters: 200, tanks: 1000, warships: 35, airDefense: 180 }
        };

        // Ø§ØªØµØ§Ù„ Ø¨Ù‡ Firebase
        async function initializeFirebase() {
            try {
                document.getElementById('loadingText').textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±...';
                document.getElementById('retryBtn').classList.add('hidden');
                
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                // ØªØ³Øª Ø§ØªØµØ§Ù„
                document.getElementById('loadingText').textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø§ØªØµØ§Ù„...';
                await db.collection('test').doc('connection').set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'connected'
                });
                
                document.getElementById('loadingText').textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ...';
                await initializeGameData();
                
                document.getElementById('loadingText').textContent = 'Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯! âœ…';
                
                setTimeout(() => {
                    document.getElementById('loadingPage').classList.add('hidden');
                    document.getElementById('loginPage').classList.remove('hidden');
                }, 1500);
                
                console.log('âœ… Firebase connected successfully');
                
            } catch (error) {
                console.error('âŒ Firebase connection failed:', error);
                document.getElementById('loadingText').textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±! âŒ';
                document.getElementById('retryBtn').classList.remove('hidden');
            }
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function initializeGameData() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                
                if (countriesSnapshot.empty) {
                    console.log('ğŸ”„ Initializing game data...');
                    const initialCountries = [
                        {
                            id: 'iran',
                            name: 'Ø§ÛŒØ±Ø§Ù†',
                            username: 'iran',
                            password: 'iran123',
                            ...countryDefaults['Ø§ÛŒØ±Ø§Ù†']
                        },
                        {
                            id: 'usa',
                            name: 'Ø¢Ù…Ø±ÛŒÚ©Ø§',
                            username: 'usa',
                            password: 'usa123',
                            ...countryDefaults['Ø¢Ù…Ø±ÛŒÚ©Ø§']
                        },
                        {
                            id: 'russia',
                            name: 'Ø±ÙˆØ³ÛŒÙ‡',
                            username: 'russia',
                            password: 'russia123',
                            ...countryDefaults['Ø±ÙˆØ³ÛŒÙ‡']
                        }
                    ];

                    const batch = db.batch();
                    for (const country of initialCountries) {
                        const countryRef = db.collection('countries').doc(country.id);
                        batch.set(countryRef, country);
                    }
                    await batch.commit();
                    
                    console.log('âœ… Game data initialized');
                } else {
                    console.log('âœ… Game data already exists');
                }
            } catch (error) {
                console.error('âŒ Error initializing game data:', error);
            }
        }

        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function toggleMobileMenu() {
            const adminMenu = document.getElementById('adminMobileMenu');
            const playerMenu = document.getElementById('playerMobileMenu');
            const adminToggle = document.getElementById('adminMenuToggle');
            const playerToggle = document.getElementById('playerMenuToggle');
            
            if (adminMenu && !document.getElementById('adminPanel').classList.contains('hidden')) {
                adminMenu.classList.toggle('open');
                if (adminToggle) adminToggle.classList.toggle('active');
            }
            if (playerMenu && !document.getElementById('playerPanel').classList.contains('hidden')) {
                playerMenu.classList.toggle('open');
                if (playerToggle) playerToggle.classList.toggle('active');
            }
        }

        function closeMobileMenu() {
            const adminMenu = document.getElementById('adminMobileMenu');
            const playerMenu = document.getElementById('playerMobileMenu');
            const adminToggle = document.getElementById('adminMenuToggle');
            const playerToggle = document.getElementById('playerMenuToggle');
            
            if (adminMenu) {
                adminMenu.classList.remove('open');
                if (adminToggle) adminToggle.classList.remove('active');
            }
            if (playerMenu) {
                playerMenu.classList.remove('open');
                if (playerToggle) playerToggle.classList.remove('active');
            }
        }

        // ÙˆØ±ÙˆØ¯
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                alert('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯! âš ï¸');
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„... â³';
            submitBtn.disabled = true;

            try {
                if (username === 'admin' && password === 'admin123') {
                    currentUser = 'admin';
                    showAdminPanel();
                } else {
                    const countriesSnapshot = await db.collection('countries').get();
                    let foundCountry = null;
                    
                    countriesSnapshot.forEach(doc => {
                        const country = doc.data();
                        if (country.username === username && country.password === password) {
                            foundCountry = { id: doc.id, ...country };
                        }
                    });
                    
                    if (foundCountry) {
                        currentUser = foundCountry.id;
                        currentCountry = foundCountry;
                        showPlayerPanel();
                    } else {
                        alert('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª! ğŸš«');
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯. âš ï¸');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
        function showAdminPanel() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            loadAdminData();
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù†
        async function showPlayerPanel() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('playerPanel').classList.remove('hidden');
            document.getElementById('countryTitle').innerHTML = `<span class="text-4xl">ğŸ´</span> ${currentCountry.name}`;
            await checkGameStatus();
            loadPlayerData();
        }

        // Ø®Ø±ÙˆØ¬
        function logout() {
            currentUser = null;
            currentCountry = null;
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('playerPanel').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginForm').reset();
            closeMobileMenu();
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ù…Ù†Ùˆ
            document.querySelectorAll('#adminSidebar .sidebar-item, #adminMobileMenu .sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll(`.sidebar-item[data-section="${section}"]`).forEach(item => {
                item.classList.add('active');
            });
            
            if (section === 'countries') loadCountriesList();
            if (section === 'economy') loadEconomySection();
            if (section === 'news') loadAdminNews();
            if (section === 'statistics') loadGlobalStats();
            if (section === 'gameControl') loadGameControlSection();
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
        function showPlayerSection(section) {
            document.querySelectorAll('.player-section').forEach(s => s.classList.add('hidden'));
            document.getElementById('player' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ù…Ù†Ùˆ
            document.querySelectorAll('#playerSidebar .sidebar-item, #playerMobileMenu .sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll(`.sidebar-item[data-section="${section}"]`).forEach(item => {
                item.classList.add('active');
            });
            
            if (section === 'dashboard') loadPlayerStats();
            if (section === 'trade') {
                loadTradeSection();
                // Ø´Ø±ÙˆØ¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø§Ø±Øª
                startTradeRequestsAutoRefresh();
            } else {
                // ØªÙˆÙ‚Ù Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ú¯Ø± Ø§Ø² Ø¨Ø®Ø´ ØªØ¬Ø§Ø±Øª Ø®Ø§Ø±Ø¬ Ø´Ø¯
                stopTradeRequestsAutoRefresh();
            }
            if (section === 'attack') loadAttackSection();
            if (section === 'news') loadNews();
        }

        let tradeRequestsInterval = null;

        // Ø´Ø±ÙˆØ¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø§Ø±Øª
        function startTradeRequestsAutoRefresh() {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† interval Ù‚Ø¨Ù„ÛŒ Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´Øª
            if (tradeRequestsInterval) {
                clearInterval(tradeRequestsInterval);
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø± 10 Ø«Ø§Ù†ÛŒÙ‡
            tradeRequestsInterval = setInterval(() => {
                if (!document.getElementById('playerTrade').classList.contains('hidden')) {
                    loadTradeRequests();
                }
            }, 10000);
        }

        // ØªÙˆÙ‚Ù Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø§Ø±Øª
        function stopTradeRequestsAutoRefresh() {
            if (tradeRequestsInterval) {
                clearInterval(tradeRequestsInterval);
                tradeRequestsInterval = null;
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
        function loadAdminData() {
            loadCountriesList();
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ú©Ø´ÙˆØ±Ù‡Ø§
        async function loadCountriesList() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                const container = document.getElementById('countriesList');
                
                const countriesHTML = [];
                countriesSnapshot.forEach(doc => {
                    const country = doc.data();
                    countriesHTML.push(`
                        <div class="glass-card p-8 text-white">
                            <div class="flex items-center gap-4 mb-6">
                                <div class="text-5xl">ğŸ´</div>
                                <div>
                                    <h3 class="text-2xl font-bold">${country.name}</h3>
                                    <p class="text-slate-300 text-sm">Ú©Ø§Ø±Ø¨Ø±: ${country.username}</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="text-center">
                                    <p class="text-xs text-slate-400 mb-2">Ù¾ÙˆÙ„</p>
                                    <p class="text-lg font-bold text-green-400">${country.money} Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-slate-400 mb-2">ÙÙ†Ø§ÙˆØ±ÛŒ</p>
                                    <p class="text-lg font-bold text-blue-400">${country.technology}%</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-slate-400 mb-2">Ø¯ÙØ§Ø¹</p>
                                    <p class="text-lg font-bold text-yellow-400">${country.defense}%</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xs text-slate-400 mb-2">Ù…ÙˆØ´Ú©</p>
                                    <p class="text-lg font-bold text-red-400">${country.missiles}</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="editCountry('${doc.id}')" class="flex-1 neutral-btn text-sm">
                                    âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù…Ù„
                                </button>
                                <button onclick="deleteCountry('${doc.id}')" class="flex-1 war-btn text-sm">
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    `);
                });
                
                container.innerHTML = countriesHTML.join('') || '<p class="text-slate-400 text-center text-2xl font-bold">Ú©Ø´ÙˆØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }

        // ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ú©Ø´ÙˆØ±
        async function editCountry(countryId) {
            try {
                const countryDoc = await db.collection('countries').doc(countryId).get();
                if (!countryDoc.exists) {
                    alert('Ú©Ø´ÙˆØ± ÛŒØ§ÙØª Ù†Ø´Ø¯! âŒ');
                    return;
                }
                
                const country = countryDoc.data();
                
                // Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´
                const editFormDiv = document.createElement('div');
                editFormDiv.id = 'editFormModal';
                editFormDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 20px;';
                
                editFormDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%); border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 20px; padding: 30px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; color: white;">
                        <h2 style="text-align: center; margin-bottom: 30px; font-size: 24px; font-weight: bold;">ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ú©Ø´ÙˆØ± ${country.name}</h2>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù†Ø§Ù… Ú©Ø´ÙˆØ±:</label>
                                <input type="text" id="editName" value="${country.name}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</label>
                                <input type="text" id="editUsername" value="${country.username}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
                                <input type="text" id="editPassword" value="${country.password}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù¾ÙˆÙ„ (Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯):</label>
                                <input type="number" id="editMoney" value="${country.money}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">ÙÙ†Ø§ÙˆØ±ÛŒ (%):</label>
                                <input type="number" id="editTech" value="${country.technology}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø¯ÙØ§Ø¹ (%):</label>
                                <input type="number" id="editDefense" value="${country.defense}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù…ÙˆØ´Ú©:</label>
                                <input type="number" id="editMissiles" value="${country.missiles}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø³Ø±Ø¨Ø§Ø²:</label>
                                <input type="number" id="editSoldiers" value="${country.soldiers}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†:</label>
                                <input type="number" id="editBombers" value="${country.bombers}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ø¬Ù†Ú¯Ù†Ø¯Ù‡:</label>
                                <input type="number" id="editFighters" value="${country.fighters}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">ØªØ§Ù†Ú©:</label>
                                <input type="number" id="editTanks" value="${country.tanks}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ:</label>
                                <input type="number" id="editWarships" value="${country.warships}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù‡ÙˆØ§ÛŒÛŒ:</label>
                                <input type="number" id="editAirDefense" value="${country.airDefense || 0}" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: rgba(0,0,0,0.3); color: white;">
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                            <button id="saveEditBtn" style="background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 15px 30px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
                                âœ… Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                            </button>
                            <button id="cancelEditBtn" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; padding: 15px 30px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
                                âŒ Ø§Ù†ØµØ±Ø§Ù
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(editFormDiv);
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listeners
                document.getElementById('saveEditBtn').addEventListener('click', () => saveCountryEdit(countryId));
                document.getElementById('cancelEditBtn').addEventListener('click', closeEditForm);
                
            } catch (error) {
                console.error('Error loading country for edit:', error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø´ÙˆØ±! âŒ');
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø´ÙˆØ±
        async function saveCountryEdit(countryId) {
            try {
                const updates = {
                    name: document.getElementById('editName').value.trim(),
                    username: document.getElementById('editUsername').value.trim(),
                    password: document.getElementById('editPassword').value.trim(),
                    money: parseInt(document.getElementById('editMoney').value) || 0,
                    technology: parseInt(document.getElementById('editTech').value) || 0,
                    defense: parseInt(document.getElementById('editDefense').value) || 0,
                    missiles: parseInt(document.getElementById('editMissiles').value) || 0,
                    soldiers: parseInt(document.getElementById('editSoldiers').value) || 0,
                    bombers: parseInt(document.getElementById('editBombers').value) || 0,
                    fighters: parseInt(document.getElementById('editFighters').value) || 0,
                    tanks: parseInt(document.getElementById('editTanks').value) || 0,
                    warships: parseInt(document.getElementById('editWarships').value) || 0,
                    airDefense: parseInt(document.getElementById('editAirDefense').value) || 0
                };

                if (!updates.name || !updates.username || !updates.password) {
                    alert('Ù†Ø§Ù… Ú©Ø´ÙˆØ±ØŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª! âš ï¸');
                    return;
                }

                await db.collection('countries').doc(countryId).update(updates);
                await addNews(`âœï¸ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ú©Ø´ÙˆØ± ${updates.name} Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø±Ø¯.`, 'Ø³ÛŒØ³ØªÙ…');
                closeEditForm();
                loadCountriesList();
                alert('âœ… Ú©Ø´ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
                
            } catch (error) {
                console.error('Error saving country edit:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª!');
            }
        }

        // Ø¨Ø³ØªÙ† ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´
        function closeEditForm() {
            const editForm = document.getElementById('editFormModal');
            if (editForm) {
                editForm.remove();
            }
        }

        // Ø­Ø°Ù Ú©Ø´ÙˆØ±
        async function deleteCountry(countryId) {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø´ÙˆØ± Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
                try {
                    const countryDoc = await db.collection('countries').doc(countryId).get();
                    const countryName = countryDoc.data().name;
                    
                    await db.collection('countries').doc(countryId).delete();
                    await addNews(`ğŸ—‘ï¸ Ú©Ø´ÙˆØ± ${countryName} ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ† Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø­Ø°Ù Ø´Ø¯.`, 'Ø³ÛŒØ³ØªÙ…');
                    loadCountriesList();
                    alert('âœ… Ú©Ø´ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
                } catch (error) {
                    console.error('Error deleting country:', error);
                    alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø´ÙˆØ±!');
                }
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø®Ø´ Ø§Ù‚ØªØµØ§Ø¯
        async function loadEconomySection() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                const select = document.getElementById('countrySelect');
                
                const options = ['<option value="">Ú©Ø´ÙˆØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>'];
                countriesSnapshot.forEach(doc => {
                    const country = doc.data();
                    options.push(`<option value="${doc.id}">${country.name}</option>`);
                });
                
                select.innerHTML = options.join('');
                
                select.addEventListener('change', async function() {
                    const countryId = this.value;
                    if (countryId) {
                        const countryDoc = await db.collection('countries').doc(countryId).get();
                        const country = countryDoc.data();
                        
                        document.getElementById('adminMoney').value = country.money;
                        document.getElementById('adminTech').value = country.technology;
                        document.getElementById('adminDefense').value = country.defense;
                        document.getElementById('adminMissiles').value = country.missiles;
                        document.getElementById('adminSoldiers').value = country.soldiers;
                        document.getElementById('adminBombers').value = country.bombers;
                        document.getElementById('adminFighters').value = country.fighters;
                        document.getElementById('adminTanks').value = country.tanks;
                        document.getElementById('adminWarships').value = country.warships;
                        document.getElementById('adminAirDefense').value = country.airDefense;
                        document.getElementById('countryEconomyForm').classList.remove('hidden');
                    }
                });
            } catch (error) {
                console.error('Error loading economy section:', error);
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ú©Ø´ÙˆØ±
        async function updateCountryEconomy() {
            const countryId = document.getElementById('countrySelect').value;
            if (!countryId) return;

            try {
                const countryDoc = await db.collection('countries').doc(countryId).get();
                const countryName = countryDoc.data().name;
                
                const updates = {
                    money: parseInt(document.getElementById('adminMoney').value),
                    technology: parseInt(document.getElementById('adminTech').value),
                    defense: parseInt(document.getElementById('adminDefense').value),
                    missiles: parseInt(document.getElementById('adminMissiles').value),
                    soldiers: parseInt(document.getElementById('adminSoldiers').value),
                    bombers: parseInt(document.getElementById('adminBombers').value),
                    fighters: parseInt(document.getElementById('adminFighters').value),
                    tanks: parseInt(document.getElementById('adminTanks').value),
                    warships: parseInt(document.getElementById('adminWarships').value),
                    airDefense: parseInt(document.getElementById('adminAirDefense').value)
                };
                
                await db.collection('countries').doc(countryId).update(updates);
                await addNews(`âš™ï¸ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ùˆ Ù†Ø¸Ø§Ù…ÛŒ ${countryName} Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø±Ø¯.`, 'Ø³ÛŒØ³ØªÙ…');
                alert('âœ… ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            } catch (error) {
                console.error('Error updating country economy:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ!');
            }
        }

        // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø´ÙˆØ± Ø¬Ø¯ÛŒØ¯
        async function addNewCountry() {
            const name = document.getElementById('newCountryName').value.trim();
            const username = document.getElementById('newCountryUsername').value.trim();
            const password = document.getElementById('newCountryPassword').value.trim();

            if (!name || !username || !password) {
                alert('âŒ Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!');
                return;
            }

            try {
                const existingCountry = await db.collection('countries').where('username', '==', username).get();
                if (!existingCountry.empty) {
                    alert('âŒ Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª!');
                    return;
                }

                const defaultStats = countryDefaults[name] || {
                    money: 500,
                    technology: 60,
                    defense: 60,
                    missiles: 100,
                    soldiers: 300000,
                    bombers: 50,
                    fighters: 200,
                    tanks: 800,
                    warships: 25,
                    airDefense: 150
                };

                const newCountry = {
                    name: name,
                    username: username,
                    password: password,
                    ...defaultStats
                };

                await db.collection('countries').doc(username).set(newCountry);
                
                document.getElementById('newCountryName').value = '';
                document.getElementById('newCountryUsername').value = '';
                document.getElementById('newCountryPassword').value = '';
                
                await addNews(`ğŸ†• Ú©Ø´ÙˆØ± Ø¬Ø¯ÛŒØ¯ ${name} Ø¨Ù‡ Ø¨Ø§Ø²ÛŒ Ù¾ÛŒÙˆØ³Øª Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ù…Ø´Ø§Ø±Ú©Øª Ø¯Ø± Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ… Ø§Ø³Øª.`, 'Ø³ÛŒØ³ØªÙ…');
                
                alert('âœ… Ú©Ø´ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            } catch (error) {
                console.error('Error adding new country:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø´ÙˆØ±!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
        async function loadGlobalStats() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                const newsSnapshot = await db.collection('news').get();
                const tradeSnapshot = await db.collection('tradeRequests').get();
                
                let totalMoney = 0;
                let totalMissiles = 0;
                let totalSoldiers = 0;
                let totalCountries = 0;
                
                countriesSnapshot.forEach(doc => {
                    const country = doc.data();
                    totalMoney += country.money || 0;
                    totalMissiles += country.missiles || 0;
                    totalSoldiers += country.soldiers || 0;
                    totalCountries++;
                });
                
                const container = document.getElementById('globalStats');
                container.innerHTML = `
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸŒ</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ Ú©Ø´ÙˆØ±Ù‡Ø§</h3>
                        <p class="text-3xl font-bold">${totalCountries}</p>
                    </div>
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸ’°</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ Ù¾ÙˆÙ„ Ø¬Ù‡Ø§Ù†</h3>
                        <p class="text-3xl font-bold">${totalMoney.toLocaleString()}</p>
                    </div>
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸš€</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§</h3>
                        <p class="text-3xl font-bold">${totalMissiles.toLocaleString()}</p>
                    </div>
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸ‘¥</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ Ø³Ø±Ø¨Ø§Ø²Ø§Ù†</h3>
                        <p class="text-3xl font-bold">${totalSoldiers.toLocaleString()}</p>
                    </div>
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸ“°</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ Ø§Ø®Ø¨Ø§Ø±</h3>
                        <p class="text-3xl font-bold">${newsSnapshot.size}</p>
                    </div>
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">ğŸ¤</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">Ú©Ù„ ØªØ¬Ø§Ø±Øªâ€ŒÙ‡Ø§</h3>
                        <p class="text-3xl font-bold">${tradeSnapshot.size}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading global stats:', error);
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø®Ø¨Ø§Ø± Ø§Ø¯Ù…ÛŒÙ†
        async function loadAdminNews() {
            try {
                const newsSnapshot = await db.collection('news').orderBy('timestamp', 'desc').get();
                const container = document.getElementById('adminNewsList');
                
                const newsHTML = [];
                newsSnapshot.forEach(doc => {
                    const news = doc.data();
                    const date = news.timestamp ? news.timestamp.toDate().toLocaleDateString('fa-IR') + ' ' + news.timestamp.toDate().toLocaleTimeString('fa-IR') : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                    newsHTML.push(`
                        <div class="news-card p-8 text-white">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="text-sm text-slate-400 mb-4 font-bold">${date}</p>
                                    <p class="text-white mb-4 text-lg font-semibold">${news.content}</p>
                                    <p class="text-sm text-green-400 font-bold">Ù…Ù†Ø¨Ø¹: ${news.author}</p>
                                </div>
                                <button onclick="deleteNews('${doc.id}')" class="war-btn">
                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    `);
                });
                
                container.innerHTML = newsHTML.join('') || '<p class="text-slate-400 text-center text-2xl font-bold">Ø®Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
            } catch (error) {
                console.error('Error loading admin news:', error);
            }
        }

        // Ø­Ø°Ù Ø®Ø¨Ø±
        async function deleteNews(newsId) {
            try {
                await db.collection('news').doc(newsId).delete();
                loadAdminNews();
                alert('âœ… Ø®Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!');
            } catch (error) {
                console.error('Error deleting news:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø®Ø¨Ø±!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
        function loadPlayerData() {
            loadPlayerStats();
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù†
        async function loadPlayerStats() {
            try {
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                const countryDoc = await db.collection('countries').doc(currentUser).get();
                if (countryDoc.exists) {
                    currentCountry = { id: currentUser, ...countryDoc.data() };
                }
                
                const statsGrid = document.getElementById('statsGrid');
                
                const stats = [
                    { icon: 'ğŸ’°', label: 'Ù¾ÙˆÙ„', value: `${currentCountry.money} Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯`, color: 'green' },
                    { icon: 'ğŸ”¬', label: 'ÙÙ†Ø§ÙˆØ±ÛŒ', value: `${currentCountry.technology}%`, color: 'blue' },
                    { icon: 'ğŸ›¡ï¸', label: 'Ø¯ÙØ§Ø¹', value: `${currentCountry.defense}%`, color: 'yellow' },
                    { icon: 'ğŸš€', label: 'Ù…ÙˆØ´Ú©', value: currentCountry.missiles, color: 'red' },
                    { icon: 'ğŸ‘¥', label: 'Ø³Ø±Ø¨Ø§Ø²', value: currentCountry.soldiers.toLocaleString(), color: 'gray' },
                    { icon: 'âœˆï¸', label: 'Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†', value: currentCountry.bombers, color: 'purple' },
                    { icon: 'ğŸ›©ï¸', label: 'Ø¬Ù†Ú¯Ù†Ø¯Ù‡', value: currentCountry.fighters, color: 'indigo' },
                    { icon: 'ğŸš—', label: 'ØªØ§Ù†Ú©', value: currentCountry.tanks, color: 'orange' },
                    { icon: 'ğŸš¢', label: 'Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ', value: currentCountry.warships, color: 'cyan' },
                    { icon: 'ğŸ›¡ï¸', label: 'Ù¾Ø¯Ø§ÙÙ†Ø¯', value: currentCountry.airDefense, color: 'pink' }
                ];

                statsGrid.innerHTML = stats.map(stat => `
                    <div class="stat-card text-white">
                        <div class="text-5xl mb-4">${stat.icon}</div>
                        <h3 class="text-sm font-bold text-slate-300 mb-2">${stat.label}</h3>
                        <p class="text-2xl font-bold">${stat.value}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading player stats:', error);
            }
        }

        // Ø®Ø±ÛŒØ¯ Ø³Ù„Ø§Ø­
        async function buyWeapon(weaponType, price) {
            if (!checkGameAccess('Ø®Ø±ÛŒØ¯ Ø³Ù„Ø§Ø­')) return;
            const qtyInput = document.getElementById(weaponType === 'missiles' ? 'missileQty' : 
                                                  weaponType === 'soldiers' ? 'soldierQty' :
                                                  weaponType === 'bombers' ? 'bomberQty' :
                                                  weaponType === 'fighters' ? 'fighterQty' :
                                                  weaponType === 'tanks' ? 'tankQty' :
                                                  weaponType === 'warships' ? 'warshipQty' :
                                                  'defenseQty');
            
            const quantity = parseInt(qtyInput.value);
            if (!quantity || quantity <= 0) {
                alert('âŒ ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±!');
                return;
            }

            const totalCost = price * quantity;
            if (currentCountry.money < totalCost) {
                alert('âŒ Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!');
                return;
            }

            try {
                const updates = {
                    money: currentCountry.money - totalCost
                };
                
                if (weaponType === 'airDefense') {
                    updates.airDefense = currentCountry.airDefense + quantity;
                    currentCountry.airDefense += quantity;
                } else {
                    updates[weaponType] = currentCountry[weaponType] + quantity;
                    currentCountry[weaponType] += quantity;
                }
                
                currentCountry.money -= totalCost;
                
                await db.collection('countries').doc(currentUser).update(updates);

                await addNews(`ğŸ›’ ${currentCountry.name} ØªØ¹Ø¯Ø§Ø¯ ${quantity} ${getWeaponName(weaponType)} Ø¨Ù‡ Ù‚ÛŒÙ…Øª ${totalCost} Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ Ø¯Ù„Ø§Ø± Ø§Ø² Ø¨Ø§Ø²Ø§Ø± Ø³ÛŒØ§Ù‡ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø±Ø¯ Ùˆ Ù‚Ø¯Ø±Øª Ù†Ø¸Ø§Ù…ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ØªÙ‚ÙˆÛŒØª Ù†Ù…ÙˆØ¯.`, currentCountry.name);

                qtyInput.value = '';
                loadPlayerStats();
                alert(`âœ… Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚! ${quantity} ${getWeaponName(weaponType)} Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯. Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.`);
            } catch (error) {
                console.error('Error buying weapon:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÛŒØ¯!');
            }
        }

        // Ù†Ø§Ù… Ø³Ù„Ø§Ø­
        function getWeaponName(weaponType) {
            const names = {
                missiles: 'Ù…ÙˆØ´Ú© Ø¨Ø§Ù„Ø³ØªÛŒÚ©',
                soldiers: 'Ø³Ø±Ø¨Ø§Ø² Ù†Ø®Ø¨Ù‡',
                bombers: 'Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©',
                fighters: 'Ø¬Ù†Ú¯Ù†Ø¯Ù‡ Ù†Ø³Ù„ Ù¾Ù†Ø¬',
                tanks: 'ØªØ§Ù†Ú© Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                warships: 'Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ',
                airDefense: 'Ø³Ø§Ù…Ø§Ù†Ù‡ Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù‡ÙˆØ§ÛŒÛŒ'
            };
            return names[weaponType] || weaponType;
        }

        // Ø§Ù†ØªØ´Ø§Ø± Ø¨ÛŒØ§Ù†ÛŒÙ‡
        async function publishStatement() {
            if (!checkGameAccess('ØµØ¯ÙˆØ± Ø¨ÛŒØ§Ù†ÛŒÙ‡')) return;
            const text = document.getElementById('statementText').value.trim();
            if (!text) {
                alert('âŒ Ù…ØªÙ† Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            try {
                await addNews(`ğŸ“¢ Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø±Ø³Ù…ÛŒ ${currentCountry.name}: ${text}`, currentCountry.name);
                document.getElementById('statementText').value = '';
                alert('âœ… Ø¨ÛŒØ§Ù†ÛŒÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù†ØªØ´Ø± Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            } catch (error) {
                console.error('Error publishing statement:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ´Ø§Ø± Ø¨ÛŒØ§Ù†ÛŒÙ‡!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø®Ø´ ØªØ¬Ø§Ø±Øª
        async function loadTradeSection() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                const select = document.getElementById('tradeCountry');
                
                const options = ['<option value="">Ú©Ø´ÙˆØ± Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>'];
                countriesSnapshot.forEach(doc => {
                    if (doc.id !== currentUser) {
                        const country = doc.data();
                        options.push(`<option value="${doc.id}">${country.name}</option>`);
                    }
                });
                
                select.innerHTML = options.join('');
                loadTradeRequests();
            } catch (error) {
                console.error('Error loading trade section:', error);
            }
        }

        // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±Øª
        async function sendTradeRequest() {
            if (!checkGameAccess('Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±Øª')) return;
            const targetCountry = document.getElementById('tradeCountry').value;
            const give = document.getElementById('tradeGive').value.trim();
            const receive = document.getElementById('tradeReceive').value.trim();

            if (!targetCountry || !give || !receive) {
                alert('âŒ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!');
                return;
            }

            try {
                const targetDoc = await db.collection('countries').doc(targetCountry).get();
                const targetCountryData = targetDoc.data();
                
                const tradeRequest = {
                    from: currentUser,
                    fromName: currentCountry.name,
                    to: targetCountry,
                    toName: targetCountryData.name,
                    give: give,
                    receive: receive,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending'
                };

                await db.collection('tradeRequests').add(tradeRequest);
                
                await addNews(`ğŸ¤ ${currentCountry.name} Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ Ø¨Ù‡ ${targetCountryData.name} Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: ${give} Ø¯Ø± Ø§Ø²Ø§ÛŒ ${receive}`, 'Ø³ÛŒØ³ØªÙ…');
                
                document.getElementById('tradeGive').value = '';
                document.getElementById('tradeReceive').value = '';
                document.getElementById('tradeCountry').value = '';
                
                alert('âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            } catch (error) {
                console.error('Error sending trade request:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø§Ø±Øª
        async function loadTradeRequests() {
            try {
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
                const tradeRequestsSnapshot = await db.collection('tradeRequests')
                    .where('to', '==', currentUser)
                    .where('status', '==', 'pending')
                    .orderBy('timestamp', 'desc')
                    .get();
                
                const container = document.getElementById('tradeRequests');
                
                const requestsHTML = [];
                tradeRequestsSnapshot.forEach(doc => {
                    const req = doc.data();
                    const date = req.timestamp ? req.timestamp.toDate().toLocaleDateString('fa-IR') + ' ' + req.timestamp.toDate().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'}) : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                    requestsHTML.push(`
                        <div class="glass-card p-6 border border-green-500/30 text-white">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="text-4xl">ğŸ¤</div>
                                <div>
                                    <p class="font-bold text-green-400 text-lg">${req.fromName}</p>
                                    <p class="text-sm text-slate-400">${date}</p>
                                </div>
                            </div>
                            <div class="space-y-3 mb-6">
                                <p class="flex items-center gap-3 text-white">
                                    <span class="text-yellow-400 text-xl">ğŸ“¤</span>
                                    Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¢Ù†Ù‡Ø§: <span class="font-bold">${req.give}</span>
                                </p>
                                <p class="flex items-center gap-3 text-white">
                                    <span class="text-blue-400 text-xl">ğŸ“¥</span>
                                    Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¢Ù†Ù‡Ø§: <span class="font-bold">${req.receive}</span>
                                </p>
                            </div>
                            <div class="flex gap-4">
                                <button onclick="acceptTrade('${doc.id}')" class="flex-1 peace-btn">
                                    âœ… Ù‚Ø¨ÙˆÙ„ Ù…Ø¹Ø§Ù…Ù„Ù‡
                                </button>
                                <button onclick="rejectTrade('${doc.id}')" class="flex-1 war-btn">
                                    âŒ Ø±Ø¯ Ù…Ø¹Ø§Ù…Ù„Ù‡
                                </button>
                            </div>
                        </div>
                    `);
                });
                
                container.innerHTML = requestsHTML.join('') || '<p class="text-slate-400 text-center text-lg">Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                
                // Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ø¹Ù†ÙˆØ§Ù†
                if (requestsHTML.length > 0) {
                    document.title = `(${requestsHTML.length}) Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ… - Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ Ø¬Ø¯ÛŒØ¯!`;
                } else {
                    document.title = 'Ø¬Ù†Ú¯ Ø¬Ù‡Ø§Ù†ÛŒ Ø³ÙˆÙ… - Ø¨Ø§Ø²ÛŒ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©';
                }
                
            } catch (error) {
                console.error('Error loading trade requests:', error);
                const container = document.getElementById('tradeRequests');
                container.innerHTML = '<p class="text-red-400 text-center text-lg">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</p>';
            }
        }

        // ØªØ§ÛŒÛŒØ¯ ØªØ¬Ø§Ø±Øª
        async function acceptTrade(tradeId) {
            if (!checkGameAccess('Ù¾Ø°ÛŒØ±Ø´ ØªØ¬Ø§Ø±Øª')) return;
            try {
                const tradeDoc = await db.collection('tradeRequests').doc(tradeId).get();
                const trade = tradeDoc.data();
                
                if (trade) {
                    await addNews(`âœ… ${trade.toName} Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ ${trade.fromName} Ø±Ø§ Ù¾Ø°ÛŒØ±ÙØª. Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯: ${trade.give} Ø¯Ø± Ø§Ø²Ø§ÛŒ ${trade.receive}`, 'Ø³ÛŒØ³ØªÙ…');
                    
                    await db.collection('tradeRequests').doc(tradeId).update({
                        status: 'accepted'
                    });
                    
                    loadTradeRequests();
                    alert('âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯! Ø´Ø±Ø­ Ú©Ø§Ù…Ù„ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø±Ø§ Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
                }
            } catch (error) {
                console.error('Error accepting trade:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø°ÛŒØ±Ø´ ØªØ¬Ø§Ø±Øª!');
            }
        }

        // Ø±Ø¯ ØªØ¬Ø§Ø±Øª
        async function rejectTrade(tradeId) {
            if (!checkGameAccess('Ø±Ø¯ ØªØ¬Ø§Ø±Øª')) return;
            try {
                const tradeDoc = await db.collection('tradeRequests').doc(tradeId).get();
                const trade = tradeDoc.data();
                
                await addNews(`âŒ ${trade.toName} Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ ${trade.fromName} Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯.`, 'Ø³ÛŒØ³ØªÙ…');
                
                await db.collection('tradeRequests').doc(tradeId).update({
                    status: 'rejected'
                });
                
                loadTradeRequests();
                alert('âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ¬Ø§Ø±ÛŒ Ø±Ø¯ Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            } catch (error) {
                console.error('Error rejecting trade:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø¯ ØªØ¬Ø§Ø±Øª!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø®Ø´ Ø­Ù…Ù„Ù‡
        async function loadAttackSection() {
            try {
                const countriesSnapshot = await db.collection('countries').get();
                const select = document.getElementById('attackTarget');
                
                const options = ['<option value="">Ù‡Ø¯Ù Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯...</option>'];
                countriesSnapshot.forEach(doc => {
                    if (doc.id !== currentUser) {
                        const country = doc.data();
                        options.push(`<option value="${doc.id}">${country.name}</option>`);
                    }
                });
                
                select.innerHTML = options.join('');
                updateAttackForm();
            } catch (error) {
                console.error('Error loading attack section:', error);
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ±Ù… Ø­Ù…Ù„Ù‡
        function updateAttackForm() {
            const attackType = document.getElementById('attackType').value;
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ÙØ±Ù…â€ŒÙ‡Ø§
            document.getElementById('airAttackForm').classList.add('hidden');
            document.getElementById('landAttackForm').classList.add('hidden');
            document.getElementById('seaAttackForm').classList.add('hidden');
            
            if (attackType && currentCountry) {
                // Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… Ù…Ø±Ø¨ÙˆØ·Ù‡ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ Ù…ÙˆØ¬ÙˆØ¯
                if (attackType === 'air') {
                    const form = document.getElementById('airAttackForm');
                    form.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-red-400">ğŸ›©ï¸ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ù‡ÙˆØ§ÛŒÛŒ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.fighters || 0})</label>
                                <input type="number" id="airFighters" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù†Ú¯Ù†Ø¯Ù‡" min="0" max="${currentCountry.fighters || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.bombers || 0})</label>
                                <input type="number" id="airBombers" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†" min="0" max="${currentCountry.bombers || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.missiles || 0})</label>
                                <input type="number" id="airMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="0" max="${currentCountry.missiles || 0}">
                            </div>
                        </div>
                    `;
                    form.classList.remove('hidden');
                } else if (attackType === 'land') {
                    const form = document.getElementById('landAttackForm');
                    form.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-red-400">ğŸš— ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ø²Ù…ÛŒÙ†ÛŒ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">ØªØ§Ù†Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.tanks || 0})</label>
                                <input type="number" id="landTanks" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ ØªØ§Ù†Ú©" min="0" max="${currentCountry.tanks || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ø³Ø±Ø¨Ø§Ø² (Ù…ÙˆØ¬ÙˆØ¯: ${(currentCountry.soldiers || 0).toLocaleString()})</label>
                                <input type="number" id="landSoldiers" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±Ø¨Ø§Ø²" min="0" max="${currentCountry.soldiers || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.missiles || 0})</label>
                                <input type="number" id="landMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="0" max="${currentCountry.missiles || 0}">
                            </div>
                        </div>
                    `;
                    form.classList.remove('hidden');
                } else if (attackType === 'sea') {
                    const form = document.getElementById('seaAttackForm');
                    form.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-red-400">ğŸš¢ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø­Ù…Ù„Ù‡ Ø¯Ø±ÛŒØ§ÛŒÛŒ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.warships || 0})</label>
                                <input type="number" id="seaWarships" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ" min="0" max="${currentCountry.warships || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ù…ÙˆØ´Ú© (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.missiles || 0})</label>
                                <input type="number" id="seaMissiles" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©" min="0" max="${currentCountry.missiles || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ø¬Ù†Ú¯Ù†Ø¯Ù‡ (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.fighters || 0})</label>
                                <input type="number" id="seaFighters" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù†Ú¯Ù†Ø¯Ù‡" min="0" max="${currentCountry.fighters || 0}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-3">Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† (Ù…ÙˆØ¬ÙˆØ¯: ${currentCountry.bombers || 0})</label>
                                <input type="number" id="seaBombers" class="war-input" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†" min="0" max="${currentCountry.bombers || 0}">
                            </div>
                        </div>
                    `;
                    form.classList.remove('hidden');
                }
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø­Ù…Ù„Ù‡
        async function launchAttack() {
            if (!checkGameAccess('Ø­Ù…Ù„Ù‡ Ù†Ø¸Ø§Ù…ÛŒ')) return;
            const target = document.getElementById('attackTarget').value;
            const attackType = document.getElementById('attackType').value;

            if (!target || !attackType) {
                alert('âŒ Ú©Ø´ÙˆØ± Ù‡Ø¯Ù Ùˆ Ù†ÙˆØ¹ Ø­Ù…Ù„Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!');
                return;
            }

            // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
            let requiredEquipment = {};
            let hasEnoughEquipment = true;
            let errorMessage = '';

            if (attackType === 'air') {
                const fighters = parseInt(document.getElementById('airFighters').value) || 0;
                const bombers = parseInt(document.getElementById('airBombers').value) || 0;
                const missiles = parseInt(document.getElementById('airMissiles').value) || 0;

                if (fighters <= 0 && bombers <= 0 && missiles <= 0) {
                    alert('âŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø§Ø² ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù‡ÙˆØ§ÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                    return;
                }

                if (fighters > (currentCountry.fighters || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.fighters || 0} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (bombers > (currentCountry.bombers || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.bombers || 0} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (missiles > (currentCountry.missiles || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.missiles || 0} Ù…ÙˆØ´Ú© Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }

                requiredEquipment = { fighters, bombers, missiles };
            } else if (attackType === 'land') {
                const tanks = parseInt(document.getElementById('landTanks').value) || 0;
                const soldiers = parseInt(document.getElementById('landSoldiers').value) || 0;
                const missiles = parseInt(document.getElementById('landMissiles').value) || 0;

                if (tanks <= 0 && soldiers <= 0 && missiles <= 0) {
                    alert('âŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø§Ø² ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø²Ù…ÛŒÙ†ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                    return;
                }

                if (tanks > (currentCountry.tanks || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.tanks || 0} ØªØ§Ù†Ú© Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (soldiers > (currentCountry.soldiers || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${(currentCountry.soldiers || 0).toLocaleString()} Ø³Ø±Ø¨Ø§Ø² Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (missiles > (currentCountry.missiles || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.missiles || 0} Ù…ÙˆØ´Ú© Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }

                requiredEquipment = { tanks, soldiers, missiles };
            } else if (attackType === 'sea') {
                const warships = parseInt(document.getElementById('seaWarships').value) || 0;
                const missiles = parseInt(document.getElementById('seaMissiles').value) || 0;
                const fighters = parseInt(document.getElementById('seaFighters').value) || 0;
                const bombers = parseInt(document.getElementById('seaBombers').value) || 0;

                if (warships <= 0 && missiles <= 0 && fighters <= 0 && bombers <= 0) {
                    alert('âŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø§Ø² ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø¯Ø±ÛŒØ§ÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                    return;
                }

                if (warships > (currentCountry.warships || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.warships || 0} Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒ Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (missiles > (currentCountry.missiles || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.missiles || 0} Ù…ÙˆØ´Ú© Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (fighters > (currentCountry.fighters || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.fighters || 0} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }
                if (bombers > (currentCountry.bombers || 0)) {
                    hasEnoughEquipment = false;
                    errorMessage += `Ø´Ù…Ø§ ÙÙ‚Ø· ${currentCountry.bombers || 0} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù† Ø¯Ø§Ø±ÛŒØ¯!\n`;
                }

                requiredEquipment = { warships, missiles, fighters, bombers };
            }

            if (!hasEnoughEquipment) {
                alert('âŒ Ø´Ù…Ø§ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±ÛŒØ¯!\n\n' + errorMessage);
                return;
            }

            try {
                const targetDoc = await db.collection('countries').doc(target).get();
                const targetCountry = targetDoc.data();

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯Ø±Øª Ø­Ù…Ù„Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡
                const attackPower = calculateAttackPowerWithEquipment(requiredEquipment, attackType, currentCountry);
                const defensePower = calculateDefensePower(targetCountry);
                
                const success = attackPower > defensePower;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ØªÙ„ÙØ§Øª ÙˆØ§Ù‚Ø¹ÛŒâ€ŒØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡
                const attackerLossPercentage = Math.random() * 0.25 + 0.15; // 15% ØªØ§ 40% ØªÙ„ÙØ§Øª
                const defenderLossPercentage = Math.random() * 0.35 + 0.25; // 25% ØªØ§ 60% ØªÙ„ÙØ§Øª

                const attackerUpdates = {};
                const defenderUpdates = {};

                // Ú©Ù… Ú©Ø±Ø¯Ù† ØªØ¬Ù‡ÛŒØ²Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø² Ø­Ù…Ù„Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡ (ØªÙ„ÙØ§Øª Ø­Ù…Ù„Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡)
                if (attackType === 'air') {
                    const fighterLoss = Math.floor(requiredEquipment.fighters * attackerLossPercentage);
                    const bomberLoss = Math.floor(requiredEquipment.bombers * attackerLossPercentage);
                    const missileLoss = Math.floor(requiredEquipment.missiles * attackerLossPercentage);
                    
                    attackerUpdates.fighters = Math.max(0, currentCountry.fighters - fighterLoss);
                    attackerUpdates.bombers = Math.max(0, currentCountry.bombers - bomberLoss);
                    attackerUpdates.missiles = Math.max(0, currentCountry.missiles - missileLoss);
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ø³ÛŒØ¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚Ø¯Ø±Øª Ù¾Ø¯Ø§ÙÙ†Ø¯
                    const defenseStrength = (targetCountry.airDefense || 0);
                    let damageMultiplier = 1;
                    
                    // Ø§Ú¯Ø± Ù¾Ø¯Ø§ÙÙ†Ø¯ Ø¶Ø¹ÛŒÙ ÛŒØ§ Ù†Ø¯Ø§Ø´ØªØŒ Ø¢Ø³ÛŒØ¨ Ø¨ÛŒØ´ØªØ±ÛŒ ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    if (defenseStrength < 50) {
                        damageMultiplier = success ? 3.0 : 2.2; // Ù¾Ø¯Ø§ÙÙ†Ø¯ Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ
                    } else if (defenseStrength < 150) {
                        damageMultiplier = success ? 2.2 : 1.6; // Ù¾Ø¯Ø§ÙÙ†Ø¯ Ø¶Ø¹ÛŒÙ
                    } else if (defenseStrength < 300) {
                        damageMultiplier = success ? 1.6 : 1.2; // Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù…ØªÙˆØ³Ø·
                    } else {
                        damageMultiplier = success ? 1.2 : 0.8; // Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù‚ÙˆÛŒ
                    }
                    
                    // ØªÙ„ÙØ§Øª Ù…Ø¯Ø§ÙØ¹ - Ø§Ø¨ØªØ¯Ø§ Ù¾Ø¯Ø§ÙÙ†Ø¯ Ù‡ÙˆØ§ÛŒÛŒ
                    const airDefenseDestroyed = Math.floor((targetCountry.airDefense || 0) * defenderLossPercentage * damageMultiplier);
                    defenderUpdates.airDefense = Math.max(0, (targetCountry.airDefense || 0) - airDefenseDestroyed);
                    
                    // Ø¢Ø³ÛŒØ¨ Ø¨Ù‡ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ùˆ Ù…Ù†Ø§Ø¨Ø¹ - Ø§Ú¯Ø± Ù¾Ø¯Ø§ÙÙ†Ø¯ Ú©Ù… Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ø³ÛŒØ¨ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ù‡ Ø³Ø§ÛŒØ± ØªØ¬Ù‡ÛŒØ²Ø§Øª
                    const moneyDamage = Math.floor(200 * damageMultiplier);
                    const fighterDamage = Math.floor(35 * damageMultiplier);
                    const bomberDamage = Math.floor(25 * damageMultiplier);
                    const missileDamage = Math.floor(40 * damageMultiplier);
                    const tankDamage = Math.floor(20 * damageMultiplier);
                    const soldierDamage = Math.floor(15000 * damageMultiplier);
                    
                    defenderUpdates.money = Math.max(0, (targetCountry.money || 0) - moneyDamage);
                    defenderUpdates.fighters = Math.max(0, (targetCountry.fighters || 0) - fighterDamage);
                    defenderUpdates.bombers = Math.max(0, (targetCountry.bombers || 0) - bomberDamage);
                    defenderUpdates.missiles = Math.max(0, (targetCountry.missiles || 0) - missileDamage);
                    defenderUpdates.tanks = Math.max(0, (targetCountry.tanks || 0) - tankDamage);
                    defenderUpdates.soldiers = Math.max(0, (targetCountry.soldiers || 0) - soldierDamage);
                    
                    currentCountry.fighters = attackerUpdates.fighters;
                    currentCountry.bombers = attackerUpdates.bombers;
                    currentCountry.missiles = attackerUpdates.missiles;
                    
                } else if (attackType === 'land') {
                    const tankLoss = Math.floor(requiredEquipment.tanks * attackerLossPercentage);
                    const soldierLoss = Math.floor(requiredEquipment.soldiers * attackerLossPercentage);
                    const missileLoss = Math.floor(requiredEquipment.missiles * attackerLossPercentage);
                    
                    attackerUpdates.tanks = Math.max(0, currentCountry.tanks - tankLoss);
                    attackerUpdates.soldiers = Math.max(0, currentCountry.soldiers - soldierLoss);
                    attackerUpdates.missiles = Math.max(0, currentCountry.missiles - missileLoss);
                    
                    // ØªÙ„ÙØ§Øª Ù…Ø¯Ø§ÙØ¹ - Ø§Ø¨ØªØ¯Ø§ Ù†ÛŒØ±ÙˆÙ‡Ø§ÛŒ Ø²Ù…ÛŒÙ†ÛŒ
                    const soldierDefLoss = Math.floor((targetCountry.soldiers || 0) * defenderLossPercentage);
                    const tankDefLoss = Math.floor((targetCountry.tanks || 0) * defenderLossPercentage);
                    defenderUpdates.soldiers = Math.max(0, (targetCountry.soldiers || 0) - soldierDefLoss);
                    defenderUpdates.tanks = Math.max(0, (targetCountry.tanks || 0) - tankDefLoss);
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ø³ÛŒØ¨ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚Ø¯Ø±Øª Ø¯ÙØ§Ø¹ Ø²Ù…ÛŒÙ†ÛŒ
                    const defenseStrength = (targetCountry.defense || 0);
                    let additionalDamageMultiplier = 1;
                    
                    if (defenseStrength < 50) {
                        additionalDamageMultiplier = success ? 2.2 : 1.6;
                    } else if (defenseStrength < 70) {
                        additionalDamageMultiplier = success ? 1.6 : 1.2;
                    } else if (defenseStrength < 85) {
                        additionalDamageMultiplier = success ? 1.2 : 0.9;
                    } else {
                        additionalDamageMultiplier = success ? 0.9 : 0.6;
                    }
                    
                    // Ø¢Ø³ÛŒØ¨ Ø¨Ù‡ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ ØªØ¬Ù‡ÛŒØ²Ø§Øª
                    const moneyDamage = Math.floor(250 * additionalDamageMultiplier);
                    const techDamage = Math.floor(8 * additionalDamageMultiplier);
                    const airDefenseDamage = Math.floor(40 * additionalDamageMultiplier);
                    
                    defenderUpdates.money = Math.max(0, (targetCountry.money || 0) - moneyDamage);
                    defenderUpdates.technology = Math.max(0, (targetCountry.technology || 0) - techDamage);
                    defenderUpdates.airDefense = Math.max(0, (targetCountry.airDefense || 0) - airDefenseDamage);
                    
                    currentCountry.tanks = attackerUpdates.tanks;
                    currentCountry.soldiers = attackerUpdates.soldiers;
                    currentCountry.missiles = attackerUpdates.missiles;
                    
                } else if (attackType === 'sea') {
                    const warshipLoss = Math.floor(requiredEquipment.warships * attackerLossPercentage);
                    const missileLoss = Math.floor(requiredEquipment.missiles * attackerLossPercentage);
                    const fighterLoss = Math.floor(requiredEquipment.fighters * attackerLossPercentage);
                    const bomberLoss = Math.floor(requiredEquipment.bombers * attackerLossPercentage);
                    
                    attackerUpdates.warships = Math.max(0, currentCountry.warships - warshipLoss);
                    attackerUpdates.missiles = Math.max(0, currentCountry.missiles - missileLoss);
                    attackerUpdates.fighters = Math.max(0, currentCountry.fighters - fighterLoss);
                    attackerUpdates.bombers = Math.max(0, currentCountry.bombers - bomberLoss);
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ø³ÛŒØ¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚Ø¯Ø±Øª Ø¯ÙØ§Ø¹ Ø¯Ø±ÛŒØ§ÛŒÛŒ
                    const navalDefenseStrength = (targetCountry.warships || 0) + (targetCountry.airDefense || 0) * 0.5;
                    let damageMultiplier = 1;
                    
                    // Ø§Ú¯Ø± Ø¯ÙØ§Ø¹ Ø¯Ø±ÛŒØ§ÛŒÛŒ Ø¶Ø¹ÛŒÙ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ø³ÛŒØ¨ Ø¨ÛŒØ´ØªØ±ÛŒ ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    if (navalDefenseStrength < 50) {
                        damageMultiplier = success ? 3.2 : 2.4;
                    } else if (navalDefenseStrength < 120) {
                        damageMultiplier = success ? 2.4 : 1.8;
                    } else if (navalDefenseStrength < 200) {
                        damageMultiplier = success ? 1.8 : 1.3;
                    } else {
                        damageMultiplier = success ? 1.3 : 0.9;
                    }
                    
                    // ØªÙ„ÙØ§Øª Ù…Ø¯Ø§ÙØ¹ - Ø§Ø¨ØªØ¯Ø§ Ù†Ø§ÙˆÚ¯Ø§Ù† Ùˆ Ù¾Ø¯Ø§ÙÙ†Ø¯
                    const warshipDefLoss = Math.floor((targetCountry.warships || 0) * defenderLossPercentage * damageMultiplier);
                    const airDefenseDestroyed = Math.floor((targetCountry.airDefense || 0) * defenderLossPercentage * damageMultiplier);
                    defenderUpdates.warships = Math.max(0, (targetCountry.warships || 0) - warshipDefLoss);
                    defenderUpdates.airDefense = Math.max(0, (targetCountry.airDefense || 0) - airDefenseDestroyed);
                    
                    // Ø¢Ø³ÛŒØ¨ Ø¨Ù‡ Ù…Ù†Ø§Ø¨Ø¹ Ùˆ ØªØ¬Ù‡ÛŒØ²Ø§Øª - Ø§Ú¯Ø± Ø¯ÙØ§Ø¹ Ø¯Ø±ÛŒØ§ÛŒÛŒ Ø¶Ø¹ÛŒÙ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ø³ÛŒØ¨ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ù‡ Ø³Ø§ÛŒØ± ØªØ¬Ù‡ÛŒØ²Ø§Øª
                    const moneyDamage = Math.floor(500 * damageMultiplier);
                    const missileDamage = Math.floor(70 * damageMultiplier);
                    const fighterDamage = Math.floor(45 * damageMultiplier);
                    const bomberDamage = Math.floor(30 * damageMultiplier);
                    const tankDamage = Math.floor(25 * damageMultiplier);
                    const soldierDamage = Math.floor(20000 * damageMultiplier);
                    
                    defenderUpdates.money = Math.max(0, (targetCountry.money || 0) - moneyDamage);
                    defenderUpdates.missiles = Math.max(0, (targetCountry.missiles || 0) - missileDamage);
                    defenderUpdates.fighters = Math.max(0, (targetCountry.fighters || 0) - fighterDamage);
                    defenderUpdates.bombers = Math.max(0, (targetCountry.bombers || 0) - bomberDamage);
                    defenderUpdates.tanks = Math.max(0, (targetCountry.tanks || 0) - tankDamage);
                    defenderUpdates.soldiers = Math.max(0, (targetCountry.soldiers || 0) - soldierDamage);
                    
                    currentCountry.warships = attackerUpdates.warships;
                    currentCountry.missiles = attackerUpdates.missiles;
                    currentCountry.fighters = attackerUpdates.fighters;
                    currentCountry.bombers = attackerUpdates.bombers;
                }

                await db.collection('countries').doc(currentUser).update(attackerUpdates);
                await db.collection('countries').doc(target).update(defenderUpdates);

                const attackTypeName = attackType === 'air' ? 'Ø­Ù…Ù„Ù‡ Ù‡ÙˆØ§ÛŒÛŒ' : attackType === 'land' ? 'Ø­Ù…Ù„Ù‡ Ø²Ù…ÛŒÙ†ÛŒ' : 'Ø­Ù…Ù„Ù‡ Ø¯Ø±ÛŒØ§ÛŒÛŒ';
                const result = success ? 'Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²' : 'Ù†Ø§Ù…ÙˆÙÙ‚';
                
                // Ø¬Ø²Ø¦ÛŒØ§Øª ØªÙ„ÙØ§Øª
                let equipmentUsed = '';
                let lossDetails = '';
                
                if (attackType === 'air') {
                    equipmentUsed = `${requiredEquipment.fighters} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ØŒ ${requiredEquipment.bombers} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†ØŒ ${requiredEquipment.missiles} Ù…ÙˆØ´Ú©`;
                    lossDetails = `ØªÙ„ÙØ§Øª ${currentCountry.name}: ${Math.floor(requiredEquipment.fighters * attackerLossPercentage)} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ØŒ ${Math.floor(requiredEquipment.bombers * attackerLossPercentage)} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†ØŒ ${Math.floor(requiredEquipment.missiles * attackerLossPercentage)} Ù…ÙˆØ´Ú©`;
                } else if (attackType === 'land') {
                    equipmentUsed = `${requiredEquipment.tanks} ØªØ§Ù†Ú©ØŒ ${requiredEquipment.soldiers.toLocaleString()} Ø³Ø±Ø¨Ø§Ø²ØŒ ${requiredEquipment.missiles} Ù…ÙˆØ´Ú©`;
                    lossDetails = `ØªÙ„ÙØ§Øª ${currentCountry.name}: ${Math.floor(requiredEquipment.tanks * attackerLossPercentage)} ØªØ§Ù†Ú©ØŒ ${Math.floor(requiredEquipment.soldiers * attackerLossPercentage).toLocaleString()} Ø³Ø±Ø¨Ø§Ø²ØŒ ${Math.floor(requiredEquipment.missiles * attackerLossPercentage)} Ù…ÙˆØ´Ú©`;
                } else {
                    equipmentUsed = `${requiredEquipment.warships} Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒØŒ ${requiredEquipment.missiles} Ù…ÙˆØ´Ú©ØŒ ${requiredEquipment.fighters} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ØŒ ${requiredEquipment.bombers} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†`;
                    lossDetails = `ØªÙ„ÙØ§Øª ${currentCountry.name}: ${Math.floor(requiredEquipment.warships * attackerLossPercentage)} Ù†Ø§Ùˆ Ø¬Ù†Ú¯ÛŒØŒ ${Math.floor(requiredEquipment.missiles * attackerLossPercentage)} Ù…ÙˆØ´Ú©ØŒ ${Math.floor(requiredEquipment.fighters * attackerLossPercentage)} Ø¬Ù†Ú¯Ù†Ø¯Ù‡ØŒ ${Math.floor(requiredEquipment.bombers * attackerLossPercentage)} Ø¨Ù…Ø¨â€ŒØ§ÙÚ©Ù†`;
                }
                
                await addNews(`âš”ï¸ ${currentCountry.name} Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ${equipmentUsed} ${attackTypeName} ${result} Ø¹Ù„ÛŒÙ‡ ${targetCountry.name} Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯. ${lossDetails}. ${success ? 'Ø­Ù…Ù„Ù‡â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ±ÙˆØ² Ø´Ø¯ Ùˆ Ø¨Ù‡ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ùˆ Ù…Ù†Ø§Ø¨Ø¹ Ø¯Ø´Ù…Ù† Ø¢Ø³ÛŒØ¨ Ø²Ø¯!' : 'Ù…Ø¯Ø§ÙØ¹ Ù…Ù‚Ø§ÙˆÙ…Øª Ú©Ø±Ø¯!'}`, 'Ø³ÛŒØ³ØªÙ…');

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…â€ŒÙ‡Ø§
                document.getElementById('attackTarget').value = '';
                document.getElementById('attackType').value = '';
                updateAttackForm();
                
                loadPlayerStats();
                alert(`${success ? 'âœ…' : 'âŒ'} Ø­Ù…Ù„Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯! Ø´Ø±Ø­ Ú©Ø§Ù…Ù„ Ø­Ù…Ù„Ù‡ Ø±Ø§ Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯.`);
            } catch (error) {
                console.error('Error launching attack:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ù…Ù„Ù‡!');
            }
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯Ø±Øª Ø­Ù…Ù„Ù‡ Ø¨Ø§ ØªØ¬Ù‡ÛŒØ²Ø§Øª Ù…Ø´Ø®Øµ
        function calculateAttackPowerWithEquipment(equipment, attackType, country) {
            let power = 0;
            const techBonus = (country.technology / 100) * 500;
            
            if (attackType === 'air') {
                power = (equipment.fighters || 0) * 3 + (equipment.bombers || 0) * 5 + (equipment.missiles || 0) * 2 + techBonus;
            } else if (attackType === 'land') {
                power = (equipment.tanks || 0) * 4 + (equipment.soldiers || 0) * 0.002 + (equipment.missiles || 0) * 2 + techBonus;
            } else if (attackType === 'sea') {
                power = (equipment.warships || 0) * 15 + (equipment.missiles || 0) * 3 + (equipment.fighters || 0) * 2 + (equipment.bombers || 0) * 4 + techBonus;
            }
            
            return power;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯Ø±Øª Ø­Ù…Ù„Ù‡
        function calculateAttackPower(country, attackType) {
            if (attackType === 'air') {
                return country.fighters * 3 + country.bombers * 5 + (country.technology / 100) * 500;
            } else if (attackType === 'land') {
                return country.tanks * 4 + country.soldiers * 0.002 + (country.technology / 100) * 300;
            } else if (attackType === 'sea') {
                return country.warships * 15 + country.missiles * 3 + (country.technology / 100) * 400;
            }
            return 0;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯Ø±Øª Ø¯ÙØ§Ø¹
        function calculateDefensePower(country) {
            return country.airDefense * 4 + (country.defense / 100) * 2000 + country.soldiers * 0.002 + (country.technology / 100) * 300;
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®Ø¨Ø±
        async function addNews(content, author) {
            try {
                await db.collection('news').add({
                    content: content,
                    author: author,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error adding news:', error);
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø®Ø¨Ø§Ø±
        async function loadNews() {
            try {
                const newsSnapshot = await db.collection('news').orderBy('timestamp', 'desc').limit(30).get();
                const container = document.getElementById('newsList');
                
                const newsHTML = [];
                newsSnapshot.forEach(doc => {
                    const news = doc.data();
                    const date = news.timestamp ? news.timestamp.toDate().toLocaleDateString('fa-IR') + ' ' + news.timestamp.toDate().toLocaleTimeString('fa-IR') : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                    newsHTML.push(`
                        <div class="news-card p-8 text-white">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="text-sm text-slate-400 mb-4 font-bold">${date}</p>
                                    <p class="text-white mb-4 text-lg font-semibold">${news.content}</p>
                                    <p class="text-sm text-green-400 font-bold">Ù…Ù†Ø¨Ø¹: ${news.author}</p>
                                </div>
                                ${news.author === currentCountry.name ? `<button onclick="deletePlayerNews('${doc.id}')" class="war-btn">ğŸ—‘ï¸ Ø­Ø°Ù</button>` : ''}
                            </div>
                        </div>
                    `);
                });
                
                container.innerHTML = newsHTML.join('') || '<p class="text-slate-400 text-center text-2xl font-bold">Ø®Ø¨Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>';
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }

        // Ø­Ø°Ù Ø®Ø¨Ø± ØªÙˆØ³Ø· Ø¨Ø§Ø²ÛŒÚ©Ù†
        async function deletePlayerNews(newsId) {
            try {
                const newsDoc = await db.collection('news').doc(newsId).get();
                const news = newsDoc.data();
                
                if (news && news.author === currentCountry.name) {
                    await db.collection('news').doc(newsId).delete();
                    loadNews();
                    alert('âœ… Ø®Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!');
                } else {
                    alert('âŒ ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø®Ø¨Ø§Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯!');
                }
            } catch (error) {
                console.error('Error deleting player news:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø®Ø¨Ø±!');
            }
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø®Ø´ Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ
        async function loadGameControlSection() {
            await checkGameStatus();
            updateGameStatusDisplay();
        }

        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        async function checkGameStatus() {
            try {
                const gameStatusDoc = await db.collection('gameSettings').doc('status').get();
                if (gameStatusDoc.exists) {
                    gameEnabled = gameStatusDoc.data().enabled;
                } else {
                    // Ø§Ú¯Ø± Ø³Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±ÙˆØ´Ù† Ø¯Ø± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ±ÛŒÙ…
                    gameEnabled = true;
                    await db.collection('gameSettings').doc('status').set({ enabled: true });
                }
                updatePlayerMenuAccess();
            } catch (error) {
                console.error('Error checking game status:', error);
                gameEnabled = true; // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø±ÙˆØ´Ù† Ø¯Ø± Ù†Ø¸Ø± Ø¨Ú¯ÛŒØ±ÛŒÙ…
            }
        }

        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        async function toggleGameStatus(enable) {
            try {
                await db.collection('gameSettings').doc('status').set({ enabled: enable });
                gameEnabled = enable;
                
                const statusText = enable ? 'Ø±ÙˆØ´Ù†' : 'Ø®Ø§Ù…ÙˆØ´';
                await addNews(`ğŸ® Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø²ÛŒ Ø±Ø§ ${statusText} Ú©Ø±Ø¯. ${enable ? 'Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø§Ú©Ù†ÙˆÙ† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¯Ø§Ø±Ù†Ø¯.' : 'Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¢Ù…Ø§Ø± Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†Ù†Ø¯.'}`, 'Ø³ÛŒØ³ØªÙ…');
                
                updateGameStatusDisplay();
                alert(`âœ… Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ${statusText} Ø´Ø¯! Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø± Ø§Ø®Ø¨Ø§Ø± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.`);
            } catch (error) {
                console.error('Error toggling game status:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ!');
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        function updateGameStatusDisplay() {
            const icon = document.getElementById('gameStatusIcon');
            const text = document.getElementById('gameStatusText');
            const desc = document.getElementById('gameStatusDesc');
            
            if (gameEnabled) {
                icon.textContent = 'ğŸŸ¢';
                text.textContent = 'Ø¨Ø§Ø²ÛŒ Ø±ÙˆØ´Ù† Ø§Ø³Øª';
                desc.textContent = 'Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¯Ø§Ø±Ù†Ø¯';
            } else {
                icon.textContent = 'ğŸ”´';
                text.textContent = 'Ø¨Ø§Ø²ÛŒ Ø®Ø§Ù…ÙˆØ´ Ø§Ø³Øª';
                desc.textContent = 'Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¢Ù…Ø§Ø± Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†Ù†Ø¯';
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù†ÙˆÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
        function updatePlayerMenuAccess() {
            const restrictedSections = ['blackmarket', 'statement', 'trade', 'attack'];
            
            restrictedSections.forEach(section => {
                const menuItems = document.querySelectorAll(`#playerSidebar .sidebar-item[data-section="${section}"], #playerMobileMenu .sidebar-item[data-section="${section}"]`);
                menuItems.forEach(item => {
                    if (gameEnabled) {
                        item.classList.remove('disabled');
                        item.onclick = () => {
                            showPlayerSection(section);
                            closeMobileMenu();
                        };
                    } else {
                        item.classList.add('disabled');
                        item.onclick = () => {
                            alert('ğŸ”´ Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø®Ø§Ù…ÙˆØ´ Ø§Ø³Øª! ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù…Ø§Ø± Ú©Ø´ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
                        };
                    }
                });
            });
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ù†Ø¬Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª
        function checkGameAccess(actionName) {
            if (!gameEnabled) {
                alert(`ğŸ”´ Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø®Ø§Ù…ÙˆØ´ Ø§Ø³Øª! Ø§Ù…Ú©Ø§Ù† ${actionName} ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.`);
                return false;
            }
            return true;
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø§ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Firebase
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebase();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9696d638c0789dc6',t:'MTc1NDIzNDgyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
